language: ruby
rvm:
  - 2.1.2
env:
  - DB=sqlite
bundler_args: --without production
cache: bundler
before_script:
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - bundle exec rake db:drop db:create db:migrate db:fixtures:load
  - RAILS_ENV=test bundle exec rake db:drop db:create db:migrate db:fixtures:load
  - bundle exec rackup -p 3000 -E test &
  - sleep 5
script:
  - # RAILS_ENV=test bundle exec rake test
  - bundle exec rake spec
  - bundle exec rake diff_images
  - ls -algt db
  - ls -algt selenium-screenshots selenium-htmlshots
